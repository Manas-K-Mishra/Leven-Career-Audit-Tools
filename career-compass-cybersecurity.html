<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leven Squad Career Compass - Cybersecurity</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        canvas {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body class="font-inter">
    <div id="root"></div>

    <script type="text/babel">
        // IMPORTANT: In a real-world application, you would use a build tool (like Webpack or Vite)
        // to compile your React code. This in-browser Babel compilation is for demonstration
        // and local file execution convenience only.

        const allQuestions = [
            // Network Security (NS) Questions
            { skill: "NS", text: "Explain the function of a firewall and different types of firewalls (e.g., stateful, stateless, WAF)." },
            { skill: "NS", text: "Describe common network attack vectors (e.g., DDoS, MiTM, sniffing) and their prevention." },
            { skill: "NS", text: "How do VPNs work, and what are their primary security benefits?" },
            { skill: "NS", text: "Discuss the role of intrusion detection/prevention systems (IDS/IPS) in network defense." },

            // Application Security (AS) Questions
            { skill: "AS", text: "What are the OWASP Top 10 vulnerabilities, and how would you mitigate Cross-Site Scripting (XSS)?" },
            { skill: "AS", text: "Explain SQL Injection and best practices to prevent it in web applications." },
            { skill: "AS", text: "Describe the secure software development lifecycle (SSDLC) and its key phases." },
            { skill: "AS", text: "How do you approach vulnerability assessments and penetration testing for web applications?" },

            // Cloud Security (CS) Questions
            { skill: "CS", text: "What are the shared responsibility model in cloud computing (e.g., AWS, Azure, GCP) and its implications for security?" },
            { skill: "CS", text: "Discuss common cloud security challenges (e.g., misconfigurations, identity access management) and solutions." },
            { skill: "CS", text: "Explain the concept of 'Infrastructure as Code' (IaC) security and its importance." },

            // Identity & Access Management (IAM) Questions
            { skill: "IAM", text: "Describe the principles of least privilege and separation of duties in IAM." },
            { skill: "IAM", text: "How does multi-factor authentication (MFA) enhance security, and what are different MFA methods?" },
            { skill: "IAM", text: "Explain the concept of Single Sign-On (SSO) and its benefits and risks." },

            // Security Operations (SecOps) Questions
            { skill: "SecOps", text: "What is a Security Information and Event Management (SIEM) system, and how is it used in a SOC?" },
            { skill: "SecOps", text: "Describe the incident response lifecycle and your role in a typical security incident." },
            { skill: "SecOps", text: "How do you approach threat intelligence and its integration into security operations?" },

            // Governance, Risk, & Compliance (GRC) Questions
            { skill: "GRC", text: "Explain the importance of cybersecurity frameworks (e.g., NIST, ISO 27001) for organizations." },
            { skill: "GRC", text: "What is risk assessment in cybersecurity, and how do you prioritize risks?" },
            { skill: "GRC", text: "Discuss the implications of data privacy regulations (e.g., GDPR, CCPA) on cybersecurity practices." }
        ];

        const App = () => {
            const [currentQ, setCurrentQ] = React.useState(0);
            const [shuffledQuestions, setShuffledQuestions] = React.useState([]);
            const [skillScores, setSkillScores] = React.useState({ NS: 0, AS: 0, CS: 0, IAM: 0, SecOps: 0, GRC: 0 });
            const [skillMax, setSkillMax] = React.useState({ NS: 0, AS: 0, CS: 0, IAM: 0, SecOps: 0, GRC: 0 });
            const [quizStarted, setQuizStarted] = React.useState(false);
            const [reportGenerated, setReportGenerated] = React.useState(false);
            const [reportData, setReportData] = React.useState(null);
            const [loading, setLoading] = React.useState(false);
            const [error, setError] = React.useState(null);

            const shuffleArray = (array) => {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            };

            const updateProgress = () => {
                const totalQuestions = shuffledQuestions.length > 0 ? shuffledQuestions.length : allQuestions.length;
                const progress = (currentQ / totalQuestions) * 100;
                return progress;
            };

            const startQuiz = () => {
                setShuffledQuestions(shuffleArray(allQuestions));
                setQuizStarted(true);
            };

            const handleNext = async () => {
                const selected = document.querySelector("input[name='q']:checked");
                if (!selected) {
                    alert("Please select an option.");
                    return;
                }

                const val = parseInt(selected.value);
                const skill = shuffledQuestions[currentQ].skill;

                setSkillScores(prevScores => ({
                    ...prevScores,
                    [skill]: prevScores[skill] + val
                }));

                setSkillMax(prevMax => ({
                    ...prevMax,
                    [skill]: prevMax[skill] + 2 // Each question adds a max possible score of 2
                }));

                if (currentQ < shuffledQuestions.length - 1) {
                    setCurrentQ(prevQ => prevQ + 1);
                } else {
                    // Quiz finished, trigger report generation
                    setCurrentQ(prevQ => prevQ + 1); // Move to a state where currentQ === shuffledQuestions.length
                }
            };

            const generateReport = React.useCallback(async () => {
                setLoading(true); // Ensure loading state is true when starting report generation
                setError(null); // Clear previous errors

                const labels = Object.keys(skillScores);
                const values = labels.map(k => {
                    if (skillMax[k] === 0) return 0; // Avoid division by zero
                    return parseFloat((skillScores[k] / skillMax[k]) * 10).toFixed(1);
                });

                const skillMap = {};
                labels.forEach((k, i) => skillMap[k] = parseFloat(values[i]));

                const prompt = `
                    Based on the following skill scores (out of 10) for Cybersecurity, provide a comprehensive career report.
                    Skill Scores: ${JSON.stringify(skillMap)}

                    The skills represent:
                    - NS: Network Security (e.g., firewalls, VPNs, IDS/IPS, network attacks)
                    - AS: Application Security (e.g., OWASP Top 10, SQLi, XSS, SSDLC, pen testing)
                    - CS: Cloud Security (e.g., shared responsibility, cloud challenges, IaC security)
                    - IAM: Identity & Access Management (e.g., least privilege, MFA, SSO)
                    - SecOps: Security Operations (e.g., SIEM, incident response, threat intelligence)
                    - GRC: Governance, Risk, & Compliance (e.g., cybersecurity frameworks, risk assessment, data privacy regulations)

                    Please generate a JSON object with the following structure:
                    {
                        "summary": "A concise summary of the user's overall strengths and areas for improvement in the Cybersecurity domain.",
                        "suggestedRoles": [
                            {
                                "title": "Job Role Title",
                                "level": "Entry/Mid/Senior",
                                "matchPercentage": "Number (0-100)",
                                "keySkills": ["Skill1", "Skill2"],
                                "skillGaps": ["Gap1", "Gap2"],
                                "advice": "Short advice (e.g., Ready to Apply, Needs Focused Prep, Foundation Needed)",
                                "suggestedDuration": "e.g., 1-2 weeks, 3-4 weeks, 6-8 weeks",
                                "projectIdea": "A specific project idea to practice skills relevant to this Cybersecurity role",
                                "toolsUsed": ["Tool1", "Tool2"],
                                "interviewQuestions": ["Provide 3-5 specific and relevant interview questions for this Cybersecurity role and skill level, covering technical, operational, regulatory, and problem-solving aspects."],
                                "roadmap": "Provide a detailed, actionable roadmap for skill improvement in Cybersecurity, including specific topics to study, resources (e.g., online courses, certifications like CompTIA Security+, CEH, CISSP, industry reports), and practical exercises or mini-projects for each identified skill gap. Break it down into clear, achievable steps over the suggested duration."
                            }
                        ]
                    }
                    Provide at least 3 relevant Cybersecurity job role suggestions (e.g., Security Analyst, Penetration Tester, Cloud Security Engineer, GRC Analyst, Incident Responder, IAM Specialist). Ensure the 'matchPercentage' is a number.
                `;

                try {
                    const chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = {
                        contents: chatHistory,
                        generationConfig: {
                            responseMimeType: "application/json",
                            responseSchema: {
                                type: "OBJECT",
                                properties: {
                                    "summary": { "type": "STRING" },
                                    "suggestedRoles": {
                                        type: "ARRAY",
                                        items: {
                                            type: "OBJECT",
                                            properties: {
                                                "title": { "type": "STRING" },
                                                "level": { "type": "STRING" },
                                                "matchPercentage": { "type": "NUMBER" },
                                                "keySkills": { "type": "ARRAY", "items": { "type": "STRING" } },
                                                "skillGaps": { "type": "ARRAY", "items": { "type": "STRING" } },
                                                "advice": { "type": "STRING" },
                                                "suggestedDuration": { "type": "STRING" },
                                                "projectIdea": { "type": "STRING" },
                                                "toolsUsed": { "type": "ARRAY", "items": { "type": "STRING" } },
                                                "interviewQuestions": { "type": "ARRAY", "items": { "type": "STRING" } },
                                                "roadmap": { "type": "STRING" }
                                            },
                                            required: ["title", "level", "matchPercentage", "keySkills", "skillGaps", "advice", "suggestedDuration", "projectIdea", "toolsUsed", "interviewQuestions", "roadmap"]
                                        }
                                    }
                                },
                                required: ["summary", "suggestedRoles"]
                            }
                        }
                    };

                    // IMPORTANT: Replace "" with your actual Gemini API Key here!
                    // You can get one from Google AI Studio (https://aistudio.google.com/app/apikey)
                    // As long as your usage stays within the free tier limits, you won't be charged.
                    const apiKey = "AIzaSyCLPDEEBMuQEyVcQDrJTmZxqDSwGIs_RG8"; // <--- YOUR GEMINI API KEY!
                    // Corrected check: ensure apiKey is not empty. Remove the specific key check.
                    if (!apiKey) {
                        setError("Gemini API Key is missing. Please add your API key to the code for dynamic reports.");
                        setLoading(false);
                        return;
                    }

                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    // Check for HTTP errors before parsing JSON
                    if (!response.ok) {
                        const errorBody = await response.json();
                        throw new Error(`API call failed with status ${response.status}: ${JSON.stringify(errorBody)}`);
                    }

                    const result = await response.json();
                    console.log("Raw API response:", result); // Log the full response for debugging

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        let jsonString = result.candidates[0].content.parts[0].text;

                        // Attempt to remove markdown code block wrapper if present
                        if (jsonString.startsWith("```json") && jsonString.endsWith("```")) {
                            jsonString = jsonString.substring(7, jsonString.length - 3).trim();
                        } else if (jsonString.startsWith("```") && jsonString.endsWith("```")) { // Generic markdown code block
                            jsonString = jsonString.substring(3, jsonString.length - 3).trim();
                        }

                        console.log("JSON string to parse:", jsonString); // Log extracted string

                        try {
                            const parsedJson = JSON.parse(jsonString);
                            setReportData(parsedJson);
                            setReportGenerated(true);
                        } catch (parseError) {
                            setError(`Failed to parse API response as JSON. Error: ${parseError.message}. Response was: ${jsonString}`);
                            console.error("JSON parse error:", parseError);
                        }
                    } else {
                        setError("Failed to generate report. Unexpected API response structure or empty content.");
                        console.error("API response structure issue:", result);
                    }
                } catch (err) {
                    console.error("Error generating report:", err);
                    setError(`Failed to generate report. Error: ${err.message}. Please try again later. Check console for details.`);
                } finally {
                    setLoading(false);
                }
            }, [skillScores, skillMax]); // Dependencies are important for useCallback

            React.useEffect(() => {
                // Only generate report if quiz is finished, not already generated, and not currently loading
                if (currentQ === shuffledQuestions.length && shuffledQuestions.length > 0 && !reportGenerated && !loading) {
                    generateReport();
                }
            }, [currentQ, shuffledQuestions.length, reportGenerated, loading, generateReport]); // Added generateReport as dependency

            React.useEffect(() => {
                if (reportGenerated && reportData) {
                    const ctx = document.getElementById("radarChart");
                    if (ctx) {
                        const labels = Object.keys(skillScores);
                        const values = labels.map(k => {
                            if (skillMax[k] === 0) return 0; // Prevent division by zero if no questions for skill
                            return parseFloat((skillScores[k] / skillMax[k]) * 10).toFixed(1);
                        });

                        if (window.myRadarChart) {
                            window.myRadarChart.destroy();
                        }

                        window.myRadarChart = new Chart(ctx.getContext("2d"), {
                            type: "radar",
                            data: {
                                labels,
                                datasets: [{
                                    label: "Skill Score (out of 10)",
                                    data: values,
                                    backgroundColor: "rgba(11, 61, 38, 0.2)",
                                    borderColor: "#0b3d26",
                                    borderWidth: 2
                                }]
                            },
                            options: {
                                scales: {
                                    r: {
                                        suggestedMin: 0,
                                        suggestedMax: 10,
                                        ticks: { stepSize: 2 },
                                        pointLabels: {
                                            font: {
                                                size: 14
                                            }
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        display: true,
                                        position: 'top',
                                        labels: {
                                            font: {
                                                size: 14
                                            }
                                        }
                                    }
                                },
                                responsive: true,
                                maintainAspectRatio: false
                            }
                        });
                    }
                }
            }, [reportGenerated, reportData, skillScores, skillMax]);

            const resetQuiz = () => {
                setCurrentQ(0);
                setShuffledQuestions([]);
                setSkillScores({ NS: 0, AS: 0, CS: 0, IAM: 0, SecOps: 0, GRC: 0 });
                setSkillMax({ NS: 0, AS: 0, CS: 0, IAM: 0, SecOps: 0, GRC: 0 });
                setQuizStarted(false);
                setReportGenerated(false);
                setReportData(null);
                setLoading(false);
                setError(null);
            };

            return (
                <div className="min-h-screen bg-gray-100 flex items-center justify-center p-4 font-inter">
                    <div className="container max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-8 md:p-12">
                        <img
                            src="https://manas-k-mishra.github.io/Leven-Career-Audit-Tools/leven-logo.jpg"
                            alt="Leven Squad"
                            className="mx-auto mb-6 max-h-20 rounded-lg"
                            onError={(e) => { e.target.onerror = null; e.target.src = "https://placehold.co/80x80/0b3d26/ffffff?text=LOGO"; }}
                        />
                        <h2 className="text-3xl font-bold text-center text-[#0b3d26] mb-2">Leven Squad Career Compass</h2>
                        <h4 className="text-lg text-center text-gray-600 mb-6"><strong>Cybersecurity Diagnostic</strong></h4>

                        {!quizStarted && !reportGenerated && (
                            <div className="text-center">
                                <p className="text-gray-700 mb-6">This diagnostic helps map your job-readiness across essential skills in the Cybersecurity industry, providing deeper insight into your strengths and areas for growth.</p>
                                <button
                                    onClick={startQuiz}
                                    className="bg-[#0b3d26] hover:bg-[#082a1c] text-white font-semibold py-3 px-8 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105"
                                >
                                    Start Quiz
                                </button>
                            </div>
                        )}

                        {quizStarted && !reportGenerated && currentQ < shuffledQuestions.length && (
                            <>
                                <div className="w-full bg-gray-200 rounded-full h-2.5 mb-6">
                                    <div
                                        className="bg-[#0b3d26] h-2.5 rounded-full transition-all duration-300 ease-in-out"
                                        style={{ width: `${updateProgress()}%` }}
                                    ></div>
                                </div>

                                <div key={currentQ} className="question-block mb-8">
                                    <p className="text-xl font-semibold text-gray-800 mb-4">Q{currentQ + 1}. {shuffledQuestions[currentQ]?.text}</p>
                                    <div className="option-group flex flex-col space-y-3">
                                        <label className="inline-flex items-center text-lg text-gray-700 cursor-pointer">
                                            <input type="radio" name="q" value="2" className="form-radio h-5 w-5 text-[#0b3d26] focus:ring-[#0b3d26] rounded-full" />
                                            <span className="ml-3">I can confidently explain and apply this.</span>
                                        </label>
                                        <label className="inline-flex items-center text-lg text-gray-700 cursor-pointer">
                                            <input type="radio" name="q" value="1" className="form-radio h-5 w-5 text-[#0b3d26] focus:ring-[#0b3d26] rounded-full" />
                                            <span className="ml-3">I have some theoretical understanding or limited practical experience.</span>
                                        </label>
                                        <label className="inline-flex items-center text-lg text-gray-700 cursor-pointer">
                                            <input type="radio" name="q" value="0" className="form-radio h-5 w-5 text-[#0b3d26] focus:ring-[#0b3d26] rounded-full" />
                                            <span className="ml-3">I am not familiar with this concept/task.</span>
                                        </label>
                                    </div>
                                </div>

                                <button
                                    onClick={handleNext}
                                    className="w-full bg-[#0b3d26] hover:bg-[#082a1c] text-white font-semibold py-3 px-8 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105"
                                    disabled={loading}
                                >
                                    {loading ? 'Generating Report...' : 'Next'}
                                </button>
                            </>
                        )}

                        {loading && (
                            <div className="text-center mt-8">
                                <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-[#0b3d26] mx-auto"></div>
                                <p className="text-gray-600 mt-4">Analyzing your Cybersecurity skills and generating a personalized report...</p>
                            </div>
                        )}

                        {error && (
                            <div className="text-center mt-8 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg">
                                <p>{error}</p>
                            </div>
                        )}

                        {reportGenerated && reportData && reportData.suggestedRoles && (
                            <div className="report mt-8">
                                <h3 className="text-2xl font-bold text-center text-[#0b3d26] mb-6">📊 Your Smart Report</h3>

                                <p className="text-gray-700 text-center mb-8 leading-relaxed">{reportData.summary}</p>

                                <div className="chart-container mb-10 h-80">
                                    <canvas id="radarChart"></canvas>
                                </div>

                                {reportData?.suggestedRoles?.map((role, index) => (
                                    <div key={index} className="jobcard bg-gray-50 p-6 border-l-4 border-[#0b3d26] rounded-lg shadow-sm mb-8">
                                        <h4 className="text-xl font-bold text-[#0b3d26] mb-2">{role.title} – {role.matchPercentage}% Match</h4>
                                        <p className="text-gray-700 mb-1"><strong>Level:</strong> {role.level}</p>
                                        <p className="text-gray-700 mb-1"><strong>Key Skills:</strong> {role.keySkills.join(", ")}</p>
                                        <p className="text-gray-700 mb-1"><strong>Gaps:</strong> {role.skillGaps.length ? role.skillGaps.join(", ") : "None"}</p>
                                        <p className="text-gray-700 mb-1"><strong>Advice:</strong> {role.advice}</p>
                                        <p className="text-gray-700 mb-1"><strong>Suggested Duration:</strong> {role.suggestedDuration}</p>
                                        <p className="text-gray-700 mb-1"><strong>Project Idea:</strong> {role.projectIdea}</p>
                                        <p className="text-700 mb-1"><strong>Tools Used:</strong> {role.toolsUsed.join(", ")}</p>
                                        <p className="text-gray-700 mb-1">
                                            <strong>Interview Questions ({role.level}):</strong>
                                        </p>
                                        <ul className="list-disc list-inside mt-1 text-sm mb-4">
                                            {role.interviewQuestions.map((q, qIndex) => (
                                                <li key={qIndex}>{q}</li>
                                            ))}
                                        </ul>
                                        <div className="roadmap bg-yellow-50 p-4 border-l-4 border-yellow-600 rounded-md text-sm text-yellow-800">
                                            <p><strong>Roadmap for Improvement:</strong></p>
                                            <p>{role.roadmap}</p>
                                        </div>
                                    </div>
                                ))}

                                <button
                                    onClick={resetQuiz}
                                    className="w-full bg-gray-600 hover:bg-gray-500 text-white font-semibold py-3 px-8 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 mt-8"
                                >
                                    🔁 Reset & Start Over
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Render the React App
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>